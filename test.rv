fn insideStruct() {
    print "Inside struct"
    struct Foo {data: []int, data2: [][]int}

    var foo = Foo{data=[10, 20], data2=[[1, 2, 3], [4, 5, 6]]}

    print "Test 1"
    var ref = foo.data
    foo.data[0] = 9
    print ref // [10, 20]
    print foo.data // [9, 20]

    print "Test 2"
    ref = foo.data
    print ref // [9, 20]
    ref[1] = 98
    print ref // [9, 98]
    print foo.data // [9, 20]

    print "Test 3" 
    print foo.data2 // [[1, 2, 3], [4, 5, 6]]
    var ref2 = foo.data2[1]
    print ref2 // [4, 5, 6]
    ref2[1] = 56
    print foo.data2 // [[1, 2, 3], [4, 5, 6]]
    print ref2 // [4, 56, 6]

    print "Test 4" 
    print foo.data2 // [[1, 2, 3], [4, 5, 6]]
    var ref3 = foo.data2[1]
    print ref3 // [4, 5, 6]
    foo.data2[1][2] = 56
    print foo.data2 // [[1, 2, 3], [4, 5, 56]]
    print ref3 // [4, 5, 6]
}


fn main() {
    insideStruct()
}


// ---------- Runtime switch on functions

// struct Person {
//     // Method
//     fn speak(self, a: int) { }
//     // Static
//     fn otherSpeak(a: int) {}
//
//     fn getSpeak(self) -> fn(int) -> void {
//         if (true) {
//             return self.speak
//         } else return Person.otherSpeak
//     }
// }


// ---------- Closure

// fn main() {
//     var a = 3
//     var closure = || { print a }
//     closure()
// }


// ---------- Cow

//struct Point {
//    x, y: int
//
//    fn display(self) {
//        print "Point"
//        print self.x
//        print self.y
//        print ""
//    }
//}
//
//struct Poly {
//    pt: Point,
//
//    fn clone(self) -> Self {
//        self.pt.x = 123
//        print self.pt.x
//
//        // self
//        Poly{pt=Point{x=1, y=2}}
//    }
//}
//
//struct Structure {
//    poly: Poly,
//    polys: []Poly,
//}
//
//struct Container {
//    arr: []Point,
//}
//
//fn main() {
//    // Var creation
//    var pt = Point{x=2, y=6}
//    var pts = [pt]
//    var poly = Poly{pt}
//    var structure = Structure{poly, polys=[poly]}
//    var container = Container{arr=pts}
//
//    // Simple identifier mutation
//    //pt.x = 9
//    //print pts[0].x
//    //print poly.pt.x
//    //pt.display()
//
//    // Array access mutation
//    //pts[0].x = 8
//    //print pts[0].x
//    //print poly.pt.x
//    //print container.arr[0].x
//    //pt.display()
//    //
//    //pts[0] = Point{x=3, y=7}
//    //container.arr[0].display()
//
//
//    // Field chain access
//    //var polyRef = structure.poly
//    //var ptRef = structure.poly.pt
//    //
//    //structure.poly.pt.y = 99
//    //print polyRef.pt.y
//    //print ptRef.y
//
//    // Field access
//    //poly.pt = Point{x=5, y=8}
//    //print structure.poly.pt.y
//    //
//    //structure.polys[0].pt.x = 5
//    //poly.pt.display()
//    //structure.polys[0].pt.display()
//
//    // In rhs
//    var tmp = poly.clone()
//    //print poly.pt.x
//    //print structure.poly.pt.x
//
//    //var tmp2 = structure.poly.clone()
//}
